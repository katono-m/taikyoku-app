<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>全会員名簿</title>
  <style>
    :root {
      --card-w: 640px;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f8f9fa;
      color: #333;
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }
    .page {
      width: min(90vw, var(--card-w));
      margin: 1.25rem auto 2rem;
    }
    h2 {
      text-align: center;
      margin: 0 0 1rem;
    }
    .table-container {
      max-height: 520px;
      overflow-y: auto;
      border: 1px solid #ddd;
      border-radius: 8px;
      background-color: #fff;
      box-shadow: 0 4px 10px rgba(0,0,0,.04);
    }
    table {
      width: 100%;
      table-layout: fixed;
      border-collapse: collapse;
      min-width: 420px; /* 不要に横長にならない最小幅 */
    }
    th, td {
      padding: 8px 10px;
      text-align: left;
      border: 1px solid #eee;
      white-space: nowrap;
    }
    thead {
      position: sticky;
      top: 0;
      background: #fff;
      z-index: 2;
    }
    a {
      text-decoration: none;
      color: inherit;
      display: block;
    }
    @media (max-width: 640px) {
      /* 画面全体を使って表示（左右余白を少なめに） */
      body {
        display: block;          /* PCのflex配置はスマホでは解除 */
        padding: 12px;
      }
      .page {
        width: 100vw;            /* スマホは全幅 */
        margin: 0 0 16px;        /* 上下だけ余白、左右は詰める */
      }

      /* テーブルまわり：横スクロールをなくし、折り返して収める */
      .table-container {
        max-height: none;        /* スマホは縦スクロールに任せる（任意） */
        border-radius: 6px;
        box-shadow: none;        /* 視認性重視で控えめに（任意） */
      }
      table {
        width: 100%;
        min-width: 0 !important; /* ← これが肝：固定最小幅を無効化 */
        table-layout: auto;      /* 内容に応じて列幅調整 */
        font-size: 14px;         /* 少しだけ凝縮 */
      }
      colgroup col {
        width: auto !important;  /* 固定列幅をスマホ時は解除 */
      }
      th, td {
        padding: 6px 8px;
        white-space: normal;     /* 折り返し許可 */
      }

      /* 見出し・リンク等をやや小さめにして情報量を確保 */
      h2 { font-size: 1.1rem; margin-bottom: 0.75rem; }
      a { font-size: 0.95rem; }
    }
  </style>
</head>
<body>
<div class="page">

  <h2>全会員名簿</h2>

  <!-- 一覧（公開：会員ID・名前・棋力のみ） -->
  <div class="table-container">
    <table>
      <colgroup>
        <col style="width: 8rem;">
        <col style="width: 12rem;">
        <col style="width: 8rem;">
      </colgroup>

      <thead>
        {% set cur_sort = sort or '' %}
        {% set cur_order = order or 'asc' %}
        {% macro sort_link(label, col) -%}
          {% set next_order = 'desc' if (cur_sort == col and cur_order == 'asc') else 'asc' %}
          <a href="{{ request.path }}?sort={{ col }}&order={{ next_order }}">
            {{ label }}
            {% if cur_sort == col %}
              {{ '▲' if cur_order == 'asc' else '▼' }}
            {% endif %}
          </a>
        {%- endmacro %}
        <tr>
          <th>{{ sort_link('会員ID', 'member_code') }}</th>
          <th>{{ sort_link('名前', 'name') }}</th>
          <th>{{ sort_link('棋力', 'grade') }}</th>
        </tr>
      </thead>

      <tbody>
        {% if rows and rows|length > 0 %}
          {% for r in rows %}
          <tr>
            <td>{{ r.member_code or '-' }}</td>
            <td>{{ r.name }}</td>
            <td>{{ r.grade }}</td>
          </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="3" style="text-align:center; padding:1rem;">データがありません</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>

</div>
</body>
</html>
